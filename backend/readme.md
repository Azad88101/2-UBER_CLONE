# API Documentation

## User Registration API

## Endpoint

`POST /user/register`

## Description

This endpoint registers a new user. On successful registration, it returns a JSON Web Token (JWT) along with the user details. The registration process validates the following:

- A valid email.
- `fullname.firstname` must be at least 3 characters long.
- A password must be at least 6 characters long.

## Request Body

Send a JSON object with the following structure:

```json
{
  "fullname": {
    "firstname": "string (min 3 chars, required)",
    "lastname": "string (optional)"
  },
  "email": "string (valid email, required)",
  "password": "string (min 6 chars, required)"
}
```

### Example Request

```json
{
  "fullname": {
    "firstname": "John",
    "lastname": "Doe"
  },
  "email": "john.doe@example.com",
  "password": "secret123"
}
```

## Responses

- **201 Created**  
  Registration was successful.

  ```json
  {
    "token": "JWT token string here",
    "user": {
      "_id": "generated id",
      "fullname": {
        "firstname": "John",
        "lastname": "Doe"
      },
      "email": "john.doe@example.com",
      "password": "hashed password"
    }
  }
  ```

- **400 Bad Request**  
  Validation error; one or more fields may be invalid.

  Response: `"something went wrong"`

- **409 Conflict**  
  A required field is missing.

  Response:

  ```json
  {
    "statusCode": 409,
    "message": "something is missing"
  }
  ```

## Notes

- The endpoint is validated using [`express-validator`](https://express-validator.github.io/docs/).
- Passwords are hashed using [`bcrypt`](https://www.npmjs.com/package/bcrypt) before being stored in the database.
- The returned JWT token is generated by an instance method in the [`User` model](backend/models/user.model.js).

---

## User Login Endpoint

**Endpoint:** `POST /user/login`

**Description:**  
Authenticates a user and returns a JSON Web Token (JWT) along with the user details if the credentials are valid.

**Request Body:**

```json
{
  "email": "string (valid email, required)",
  "password": "string (min 6 chars, required)"
}
```

**Example Request:**

```json
{
  "email": "john.doe@example.com",
  "password": "secret123"
}
```

**Responses:**

- **200 OK**  
  Successful login.

  ```json
  {
    "token": "JWT token string here",
    "user": {
      "_id": "user id",
      "fullname": {
        "firstname": "John",
        "lastname": "Doe"
      },
      "email": "john.doe@example.com",
      "password": "hashed password"
    }
  }
  ```

- **409 Conflict**  
  A required field is missing.

  ```json
  {
    "statusCode": 409,
    "message": "somethng is missing"
  }
  ```

- **401 Unauthorized**  
  Invalid email or password.
  ```json
  {
    "statusCode": 401,
    "message": "Imvalid email or password"
  }
  ```

---

## Notes

- Endpoints are validated using [express-validator](https://express-validator.github.io/docs/).
- Passwords are hashed with [bcrypt](https://www.npmjs.com/package/bcrypt) before storage.
- JWT tokens are generated using a method in the [User model](../models/user.model.js).

# User Profile & Logout Endpoints Documentation

## 1. Get User Profile

**Endpoint:** `GET /user/profile`

**Description:**  
Retrieves the profile details of the currently logged-in user. This endpoint is protected and requires a valid JWT (provided via cookies or the `Authorization` header).

**Authentication:**

- The user must be authenticated.
- Middleware verifies the JWT and attaches the user object to `req.user`.

**Example Request:**

```
GET /user/profile
Cookie: token=your_jwt_token_here
```

**Responses:**

- **200 OK**  
  Returns the logged-in user's data.

  ```json
  {
    "success": true,
    "user": {
      "_id": "user id",
      "fullname": {
        "firstname": "John",
        "lastname": "Doe"
      },
      "email": "john.doe@example.com",
      "password": "hashed password"
    }
  }
  ```

- **401 Unauthorized**  
  If the user is not authenticated or token is invalid/missing.
  ```json
  {
    "message": "Unauthorized"
  }
  ```

---

## 2. Logout

**Endpoint:** `GET /user/logout`

**Description:**  
Logs out the user by clearing the authentication cookie and blacklisting the current JWT token so it can no longer be used.

**Example Request:**

```
GET /user/logout
Cookie: token=your_jwt_token_here
```

**Responses:**

- **200 OK**  
  Indicates the user has been logged out successfully.

  ```json
  {
    "message": "Logged out succesfully"
  }
  ```

- **401 Unauthorized**  
  In case of issues with the token (e.g., if not provided or already invalidated by middleware in related endpoints).

---

## Notes

- The `/user/profile` endpoint is protected by authentication middleware.
- On logout, the token is cleared from the cookies and stored in a blacklist to prevent further use.

# Captain Registration API

## Endpoint

`POST /captain/register`

## Description

This endpoint registers a new captain. On successful registration, it returns a JSON Web Token (JWT) along with the captain's details. The registration process validates the following:

- A valid email.
- `fullname.firstname` must be at least 3 characters long.
- A password must be at least 6 characters long.
- Vehicle details must be provided, including color, plate, capacity, and vehicle type.

## Request Body

Send a JSON object with the following structure:

```json
{
  "fullname": {
    "firstname": "string (min 3 chars, required)",
    "lastname": "string (optional)"
  },
  "email": "string (valid email, required)",
  "password": "string (min 6 chars, required)",
  "vehicle": {
    "color": "string (min 3 chars, required)",
    "plate": "string (min 6 chars, required)",
    "capacity": "number (min 1, required)",
    "vehicleType": "string (must be one of: car, bike, auto, required)"
  }
}
```

### Example Request

```json
{
  "fullname": {
    "firstname": "Jane",
    "lastname": "Doe"
  },
  "email": "jane.doe@example.com",
  "password": "secret123",
  "vehicle": {
    "color": "red",
    "plate": "ABC123",
    "capacity": 2,
    "vehicleType": "car"
  }
}
```

## Responses

- **201 Created**  
  Registration was successful. The response will include the JWT token and captain details.

  ```json
  {
    "token": "JWT token string here",
    "captain": {
      "_id": "generated id",
      "fullname": {
        "firstname": "Jane",
        "lastname": "Doe"
      },
      "email": "jane.doe@example.com",
      "vehicle": {
        "color": "red",
        "plate": "ABC123",
        "capacity": 2,
        "vehicleType": "car"
      }
    }
  }
  ```

- **400 Bad Request**  
  Validation error; one or more fields may be invalid.

  Response:

  ```json
  {
    "statusCode": 400,
    "message": "something went wrong"
  }
  ```

- **409 Conflict**  
  A required field is missing or the captain already exists.

  Response:

  ```json
  {
    "statusCode": 409,
    "message": "something is missing or captain already exists"
  }
  ```

## Notes

- The endpoint is validated using [`express-validator`](https://express-validator.github.io/docs/).
- Passwords are hashed using [`bcrypt`](https://www.npmjs.com/package/bcrypt) before being stored in the database.
- The returned JWT token is generated by an instance method in the [`Captain` model](backend/models/captain.model.js).
- Ensure that the server is running and the database is connected before making requests to this endpoint.
- Use appropriate headers, such as `Content-Type: application/json`, when making requests.

## Example cURL Request

```bash
curl -X POST http://localhost:3000/captain/register \
-H "Content-Type: application/json" \
-d '{
  "fullname": {
    "firstname": "Jane",
    "lastname": "Doe"
  },
  "email": "jane.doe@example.com",
  "password": "secret123",
  "vehicle": {
    "color": "red",
    "plate": "ABC123",
    "capacity": 2,
    "vehicleType": "car"
  }
}'
```

This README section provides a comprehensive overview of the `captain/register` endpoint, including all necessary details for developers to understand how to use it effectively.



# Captain Login API

## Endpoint

`POST /captain/login`

## Description

This endpoint authenticates a captain and returns a JSON Web Token (JWT) along with the captain's details if the credentials are valid. The login process validates:

- A valid email format
- Password must be at least 6 characters long

## Request Body

Send a JSON object with the following structure:

```json
{
  "email": "string (valid email, required)",
  "password": "string (min 6 chars, required)"
}
```

### Example Request

```json
{
  "email": "jane.doe@example.com",
  "password": "secret123"
}
```

## Responses

- **200 OK**  
  Login was successful. The response includes the JWT token and captain details.

  ```json
  {
    "message": "user Logged In succesfully",
    "data": {
      "token": "JWT token string here",
      "captain": {
        "_id": "captain id",
        "fullname": {
          "firstname": "Jane",
          "lastname": "Doe"
        },
        "email": "jane.doe@example.com",
        "vehicle": {
          "color": "red",
          "plate": "ABC123",
          "capacity": 2,
          "vehicleType": "car"
        }
      }
    }
  }
  ```

- **400 Bad Request**  
  Validation error; email or password format is invalid.

  ```json
  {
    "message": "error from froontend",
    "error": [
      {
        "msg": "Invalid email",
        "param": "email",
        "location": "body"
      }
    ]
  }
  ```

- **409 Conflict**  
  Invalid credentials or missing fields.

  ```json
  {
    "statusCode": 409,
    "message": "email or password is wrong"
  }
  ```

## Notes

- The endpoint is validated using [`express-validator`](https://express-validator.github.io/docs/).
- Passwords are compared using bcrypt's compare function.
- The JWT token is generated using the captain's ID and stored in both the response and cookies.
- The token can be used for subsequent authenticated requests.
- The endpoint checks for blacklisted tokens to prevent unauthorized access.

## Example cURL Request

```bash
curl -X POST http://localhost:3000/captain/login \
-H "Content-Type: application/json" \
-d '{
  "email": "jane.doe@example.com",
  "password": "secret123"
}'
```


# Captain Profile & Logout Endpoints Documentation

## 1. Get Captain Profile

**Endpoint:** `GET /captain/profile`

**Description:**  
Retrieves the profile details of the currently logged-in captain. This endpoint is protected and requires a valid JWT (provided via cookies or the `Authorization` header).

**Authentication:**

- The captain must be authenticated
- Middleware verifies the JWT and attaches the captain object to `req.captain`

**Example Request:**

```
GET /captain/profile
Cookie: token=your_jwt_token_here
```

**Responses:**

- **200 OK**  
  Returns the logged-in captain's data.

  ```json
  {
    "data": {
      "_id": "captain id",
      "fullname": {
        "firstname": "Jane",
        "lastname": "Doe"
      },
      "email": "jane.doe@example.com",
      "vehicle": {
        "color": "red",
        "plate": "ABC123",
        "capacity": 2,
        "vehicleType": "car"
      }
    }
  }
  ```

- **401 Unauthorized**  
  If the captain is not authenticated or token is invalid/missing.
  ```json
  {
    "message": "Unauthorized"
  }
  ```

---

## 2. Captain Logout

**Endpoint:** `GET /captain/logout`

**Description:**  
Logs out the captain by:

- Clearing the authentication cookie
- Blacklisting the current JWT token to prevent further use

**Example Request:**

```
GET /captain/logout
Cookie: token=your_jwt_token_here
```

**Responses:**

- **200 OK**  
  Indicates the captain has been logged out successfully.

  ```json
  {
    "message": "Logged out succesfully"
  }
  ```

- **401 Unauthorized**  
  If the captain is not authenticated or token is invalid/missing.
  ```json
  {
    "message": "Unauthorized"
  }
  ```

---

## Notes

- Both endpoints are protected by the `CaptainAuth` middleware
- The token can be provided either through cookies or the `Authorization` header
- On logout, the token is:
  1. Cleared from the cookies
  2. Added to the blacklist collection to prevent reuse
- The blacklist mechanism ensures that logged-out tokens cannot be used for authentication

